<c-card class="mb-4">
  <c-card-body class="w-100">
    <div class="table-responsive">
      <ng-container>
        <div *ngIf="loading">
          <app-loading></app-loading>
        </div>

        <div class="row justify-content-end py-2">
          <div class="w-25 pb-2">
            <c-input-group>
              <span cInputGroupText id="basic-addon1"><i class="fa fa-search"></i></span>
              <input id="appendedInputButton" (input)="onSearchDetail($event)" class="form-control" size="16"
                type="text" placeholder="Search...">
            </c-input-group>
          </div>
        </div>

        <table *ngIf="filteredListTypeOrder as list" bordered [hover]="true" [responsive]="true" [striped]="true"
          align="middle" cTable class="mb-0 border">
          <thead>
            <tr>
              <th scope="col" style="background-color: #3c4b64; color:white; vertical-align: middle;" class="text-center align-items-start" rowspan="2">Kode
                Barang</th>
              <th scope="col" style="background-color: #3c4b64; color:white; vertical-align: middle;" class="text-center align-items-start" rowspan="3">Nama
                Barang</th>
              <th scope="col" style="background-color: #3c4b64; color:white; vertical-align: middle;" class="text-center align-items-start" rowspan="2">
                Total Pesanan</th>
              <th scope="col" style="background-color: #e55353; color:white; vertical-align: middle;" class="text-center align-items-start btn-danger" colspan="2">Qty
                Kirim</th> <!-- Masih sejajar -->
              <th scope="col" style="background-color: #3c4b64; color:white; vertical-align: middle;" class="text-center align-items-start" rowspan="2">
                Konversi Gudang</th>
              <th scope="col" style="background-color: #3c4b64; color:white; vertical-align: middle;" class="text-center align-items-start" rowspan="2">
                Total Kirim Gudang
              </th>
              <th scope="col" style="background-color: #3c4b64; color:white; vertical-align: middle;" class="text-center align-items-start" rowspan="2">
                Selisih Pesanan</th>
            </tr>
            <tr>
              <th scope="col" class="text-center" style="width:160px;background-color: #3c4b64; color:white; vertical-align: middle; ">Besar</th>
              <th scope="col" class="text-center" style="width:160px;background-color: #3c4b64; color:white; vertical-align: middle;">Kecil</th>
            </tr>
          </thead>
          <tbody *ngIf="!list || list.length === 0">
            <tr>
              <td colspan="8" scope="col" class="text-center">
                No Data Found
              </td>
            </tr>
          </tbody>
          <tbody>
            <tr *ngFor="let data of list | paginate: {
                itemsPerPage: 5,
                currentPage: listCurrentPage,
                totalItems:totalLengthList,
                id:'dataTableDetail'
            }; let i = index">
              <td class="text-center">{{ data.kodeBarang }}</td>
              <td class="text-center">{{ data.namaBarang }}</td>
              <td class="text-center">{{ data.totalQtyPesan }}.00 {{data.satuanKecil}}</td>
              <!-- <td class="text-center">{{ data.qtyPesanBesar }} {{ data.satuanBesar }}</td> -->

              <td class="text-center input-column">
                <div class="d-flex" style="gap: 5px;">
                  <input type="text" numberOnly max="{{data.qtyPesanBesar}}" min="0"
                    [ngClass]="{'form-invalid': validationMessages[i]}"
                    class="form-control text-center inputQty inputNumberSpace" [(ngModel)]="data.qtyPesanBesar"
                    (input)="onInputValueItemDetail($event, i, 'numeric', 'besar')" 
                    (keypress)="g.conditionInput($event, 'numeric')" autofocus
                     />
                  <span class="d-flex align-items-center justify-content-center">{{data.satuanBesar}}</span>
                </div>
                <span style="font-size: 14px;" class="text-danger" *ngIf="validationMessages[i]">
                  {{ validationMessages[i] }}
                </span>
              </td>

              <td class="text-center input-column">
                <div class="d-flex" style="gap: 5px;">
                  <input type="text" numberOnly max="{{data.qtyPesanKecil}}" min="0"
                    [ngClass]="{'form-invalid': validationMessages[i]}"
                    class="form-control text-center inputQty inputNumberSpace" [(ngModel)]="data.qtyPesanKecil"
                    (input)="onInputValueItemDetail($event, i, 'numeric', 'kecil')"
                    (keypress)="g.conditionInput($event, 'numeric')"
                    />
                  <span class="d-flex align-items-center justify-content-center">{{data.satuanKecil}}
                  </span>
                </div>
                <!-- <span style="font-size: 14px;" class="text-danger" *ngIf="validationMessages[i]">
                  {{ validationMessages[i] }}
                </span> -->
              </td>

              <td class="text-center">{{ data.konversi }}.00</td>
              <td class="text-center">{{(helper.sanitizedNumber(data.qtyPesanBesar) *
                data.konversi) + helper.sanitizedNumber(data.qtyPesanKecil)}}.00 {{data.satuanKecil}}
              </td>
              <td class="text-center">{{(helper.sanitizedNumber(data.totalQtyPesan) -
                (helper.sanitizedNumber(data.qtyPesanBesar) *
                data.konversi))}} {{data.satuanKecil}}
              </td>
            </tr>
          </tbody>
        </table>
        <div class="mt-2 text-start">
          <c-pagination>
            <pagination-controls (pageChange)="listCurrentPage = $event" id="dataTableDetail"></pagination-controls>
          </c-pagination>
        </div>
      </ng-container>
    </div>
  </c-card-body>
</c-card>

<div class="d-grid gap-3 d-md-flex justify-content-end">
  <button class="btn btn-info text-white btn-150 pe-3" (click)="onSubmit()">
    <i class="fa fa-check pe-2" *ngIf="!adding"></i>
    <i class="fa fa-spinner fa-spin" *ngIf="adding"></i>
    {{ "Proses Pengiriman" | translate }}
  </button>

  <button class="btn btn-secondary text-white btn-150" (click)="onBackPressed()">
    <i class="fa fa-times pe-1"></i> {{ "Batal" | translate }}
  </button>
</div>